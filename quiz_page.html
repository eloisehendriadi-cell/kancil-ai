{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h2>{{ topic }} Quiz</h2>
  <div id="quiz-box"></div>
  <div id="result" class="mt-3"></div>
</div>

<script>
const questions = {{ questions | tojson }};
let index = 0;
let score = 0;

function renderQuestion() {
  if (index >= questions.length) {
    document.getElementById("quiz-box").innerHTML = "";
    document.getElementById("result").innerHTML = `
      <h4>ğŸ‰ You completed the quiz!</h4>
      <p>Mastery: ${score * 20}%</p>
      ${score === 5 ? '<div class="confetti">ğŸŠğŸŠğŸŠ</div>' : ''}
    `;
    return;
  }

  const q = questions[index];
  const options = q.options.map((opt, i) => `
    <button class="btn btn-outline-secondary d-block my-2 option-btn" data-choice="${'ABCD'[i]}">
      ${'ABCD'[i]}. ${opt}
    </button>`).join('');

  document.getElementById("quiz-box").innerHTML = `
    <h5>${q.question}</h5>
    ${options}
  `;

  document.querySelectorAll(".option-btn").forEach(btn => {
    btn.addEventListener("click", () => checkAnswer(btn.getAttribute("data-choice")));
  });
}

function checkAnswer(choice) {
  const correct = questions[index].answer;
  const feedback = choice === correct
    ? "<div class='text-success mt-2'>âœ… Correct!</div>"
    : `<div class='text-danger mt-2'>âŒ Wrong! The correct answer was <strong>${correct}</strong>.</div>`;

  if (choice === correct) score++;

  document.querySelectorAll(".option-btn").forEach(btn => btn.disabled = true);
  document.getElementById("quiz-box").insertAdjacentHTML("beforeend", feedback);

  setTimeout(() => {
    index++;
    renderQuestion();
  }, 1500);
}

renderQuestion();
</script>
{% endblock %}


{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h2>ğŸ§  Note Generator</h2>

  <form method="POST" enctype="multipart/form-data">
    <div class="form-check mb-3">
      <input class="form-check-input" type="radio" name="method" id="text" value="text" checked>
      <label class="form-check-label" for="text">âœï¸ From Text</label>
    </div>
    <div class="form-check mb-3">
      <input class="form-check-input" type="radio" name="method" id="pdf" value="pdf">
      <label class="form-check-label" for="pdf">ğŸ“„ From PDF</label>
    </div>
    <div class="form-check mb-3">
      <input class="form-check-input" type="radio" name="method" id="youtube" value="youtube">
      <label class="form-check-label" for="youtube">ğŸ¥ From YouTube</label>
    </div>

    <div class="mb-3">
      <textarea class="form-control" name="note_input" rows="5" placeholder="Enter your content here..."></textarea>
    </div>
    <div class="mb-3">
      <input type="file" class="form-control" name="note_pdf">
    </div>
    <div class="mb-3">
      <input type="text" class="form-control" name="note_youtube" placeholder="Paste YouTube URL here...">
    </div>

    <div class="alert alert-info">â³ This may take a few minutes depending on the file size or content length...</div>
    <button type="submit" class="btn btn-primary">âœ¨ Generate Notes</button>
  </form>

  {% if output %}
    <div class="card mt-4">
      <div class="card-header">ğŸ“ Your Generated Notes</div>
      <div class="card-body" id="generated-note">{{ output|safe }}</div>
    </div>
    <button class="btn btn-success mt-3" onclick="openSaveModal()">ğŸ’¾ Save This Note</button>
  {% endif %}

  <!-- Save Modal -->
  <div class="modal" id="saveModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Save Your Note</h5>
          <button type="button" class="btn-close" onclick="closeSaveModal()"></button>
        </div>
        <div class="modal-body">
          <input type="text" id="note-title" class="form-control" placeholder="Enter note title">
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeSaveModal()">Cancel</button>
          <button class="btn btn-primary" onclick="saveNote()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function openSaveModal() {
      document.getElementById("saveModal").style.display = "block";
    }

    function closeSaveModal() {
      document.getElementById("saveModal").style.display = "none";
    }

    function saveNote() {
      const title = document.getElementById("note-title").value;
      const content = document.getElementById("generated-note").innerHTML;

      fetch("/save_note", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ title, content })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert("âœ… Note saved successfully!");
          closeSaveModal();
        } else {
          alert("âŒ Failed to save note.");
        }
      });
    }
  </script>
{% endblock %}

